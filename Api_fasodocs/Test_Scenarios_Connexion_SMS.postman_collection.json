{
	"info": {
		"_postman_id": "test-scenarios-sms-2025",
		"name": "Test ScÃ©narios Connexion SMS - VÃ©rifications",
		"description": "Collection pour tester les vÃ©rifications de sÃ©curitÃ© avant l'envoi de SMS",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "âŒ ScÃ©nario 1 - NumÃ©ro Non EnregistrÃ©",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('âŒ Erreur attendue : NumÃ©ro non enregistrÃ©', function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"const responseJson = pm.response.json();",
							"",
							"pm.test('âŒ Message d\\'erreur correct', function () {",
							"    pm.expect(responseJson.success).to.be.false;",
							"    pm.expect(responseJson.message).to.include('non enregistrÃ©');",
							"});",
							"",
							"console.log('');",
							"console.log('âŒ ========================================');",
							"console.log('âŒ SCÃ‰NARIO 1 : NUMÃ‰RO NON ENREGISTRÃ‰');",
							"console.log('âŒ ========================================');",
							"console.log('');",
							"console.log('ğŸ“± NumÃ©ro testÃ© : +22370999999');",
							"console.log('âŒ RÃ©sultat : ' + responseJson.message);",
							"console.log('');",
							"console.log('âœ… SÃ‰CURITÃ‰ OK : Pas de SMS envoyÃ© !');",
							"console.log('âœ… VÃ©rification BDD effectuÃ©e AVANT envoi SMS');",
							"console.log('');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"telephone\": \"+22370999999\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/connexion-telephone",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"auth",
						"connexion-telephone"
					]
				},
				"description": "Test avec un numÃ©ro qui n'existe pas en base de donnÃ©es.\nATTENDU : Erreur 400, message 'non enregistrÃ©', PAS de SMS envoyÃ©"
			},
			"response": []
		},
		{
			"name": "âœ… ScÃ©nario 2A - Inscription PrÃ©alable",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"if (pm.response.code === 200) {",
							"    pm.test('âœ… Inscription rÃ©ussie', function () {",
							"        pm.response.to.have.status(200);",
							"    });",
							"    ",
							"    const responseJson = pm.response.json();",
							"    pm.test('âœ… Message de succÃ¨s', function () {",
							"        pm.expect(responseJson.success).to.be.true;",
							"    });",
							"    ",
							"    console.log('');",
							"    console.log('âœ… Utilisateur inscrit avec succÃ¨s');",
							"    console.log('ğŸ“± TÃ©lÃ©phone : +22370123456');",
							"    console.log('â¡ï¸  Passez au test suivant (ScÃ©nario 2B)');",
							"    console.log('');",
							"} else {",
							"    console.log('âš ï¸ Utilisateur dÃ©jÃ  inscrit (OK pour continuer les tests)');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"telephone\": \"+22370123456\",\n    \"email\": \"test-scenario@fasodocs.ml\",\n    \"motDePasse\": \"Test123!\",\n    \"confirmerMotDePasse\": \"Test123!\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/inscription",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"auth",
						"inscription"
					]
				},
				"description": "Inscription d'un utilisateur pour tester ensuite la connexion avec un numÃ©ro valide"
			},
			"response": []
		},
		{
			"name": "âœ… ScÃ©nario 2B - NumÃ©ro EnregistrÃ© (SMS EnvoyÃ©)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('âœ… Connexion acceptÃ©e', function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"const responseJson = pm.response.json();",
							"",
							"pm.test('âœ… SMS envoyÃ© avec succÃ¨s', function () {",
							"    pm.expect(responseJson.success).to.be.true;",
							"    pm.expect(responseJson.message).to.include('code de vÃ©rification');",
							"});",
							"",
							"pm.test('âœ… NumÃ©ro masquÃ© dans la rÃ©ponse', function () {",
							"    pm.expect(responseJson.message).to.include('***');",
							"});",
							"",
							"console.log('');",
							"console.log('âœ… ========================================');",
							"console.log('âœ… SCÃ‰NARIO 2 : NUMÃ‰RO ENREGISTRÃ‰');",
							"console.log('âœ… ========================================');",
							"console.log('');",
							"console.log('ğŸ“± NumÃ©ro testÃ© : +22370123456');",
							"console.log('âœ… RÃ©sultat : ' + responseJson.message);",
							"console.log('');",
							"console.log('ğŸ” VÃ©rifications effectuÃ©es :');",
							"console.log('   1. âœ… NumÃ©ro existe en BDD');",
							"console.log('   2. âœ… Compte actif');",
							"console.log('   3. âœ… Code gÃ©nÃ©rÃ© (6 chiffres)');",
							"console.log('   4. âœ… Code sauvegardÃ© avec expiration');",
							"console.log('   5. âœ… SMS envoyÃ©');",
							"console.log('');",
							"console.log('ğŸ“± VÃ©rifiez :');",
							"console.log('   - Votre tÃ©lÃ©phone (si SMS activÃ©)');",
							"console.log('   - Les logs de l\\'application (si SMS dÃ©sactivÃ©)');",
							"console.log('');",
							"console.log('ğŸ“ Cherchez dans les logs :');",
							"console.log('   \"Code SMS envoyÃ© avec succÃ¨s pour: +22370123456\"');",
							"console.log('');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"telephone\": \"+22370123456\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/connexion-telephone",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"auth",
						"connexion-telephone"
					]
				},
				"description": "Test avec un numÃ©ro ENREGISTRÃ‰.\nATTENDU : SuccÃ¨s 200, SMS envoyÃ©, numÃ©ro masquÃ© dans rÃ©ponse"
			},
			"response": []
		},
		{
			"name": "ğŸ“Š VÃ©rification BDD - Voir le Code",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log('');",
							"console.log('ğŸ“Š ========================================');",
							"console.log('ğŸ“Š VÃ‰RIFICATION BASE DE DONNÃ‰ES');",
							"console.log('ğŸ“Š ========================================');",
							"console.log('');",
							"console.log('ğŸ’¡ Pour voir le code SMS dans la BDD :');",
							"console.log('');",
							"console.log('SQL Ã  exÃ©cuter :');",
							"console.log('');",
							"console.log('SELECT telephone, code_sms, code_sms_expiration');",
							"console.log('FROM citoyens');",
							"console.log('WHERE telephone = \\'+22370123456\\';');",
							"console.log('');",
							"console.log('RÃ©sultat attendu :');",
							"console.log('â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”');",
							"console.log('â”‚ telephone       â”‚ code_sms â”‚ code_sms_expiration â”‚');",
							"console.log('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤');",
							"console.log('â”‚ +22370123456    â”‚ 123456   â”‚ 2025-XX-XX 14:35:00 â”‚');",
							"console.log('â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜');",
							"console.log('');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/procedures",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"procedures"
					]
				},
				"description": "RequÃªte fictive pour afficher les instructions SQL dans la console"
			},
			"response": []
		},
		{
			"name": "ğŸ” Test Format TÃ©lÃ©phone Invalide",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test('âŒ Erreur attendue : Format invalide', function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"console.log('');",
							"console.log('ğŸ” ========================================');",
							"console.log('ğŸ” TEST FORMAT TÃ‰LÃ‰PHONE INVALIDE');",
							"console.log('ğŸ” ========================================');",
							"console.log('');",
							"console.log('âŒ Format testÃ© : 0701234567 (INVALIDE)');",
							"console.log('âœ… Format attendu : +223XXXXXXXX');",
							"console.log('');",
							"console.log('âœ… VALIDATION OK : Format rejetÃ© !');",
							"console.log('');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"telephone\": \"0701234567\"\n}"
				},
				"url": {
					"raw": "{{base_url}}/api/auth/connexion-telephone",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"auth",
						"connexion-telephone"
					]
				},
				"description": "Test avec un format de tÃ©lÃ©phone invalide (sans +223)"
			},
			"response": []
		},
		{
			"name": "ğŸ“‹ RÃ©sumÃ© des Tests",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log('');",
							"console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');",
							"console.log('â•‘                                                    â•‘');",
							"console.log('â•‘        RÃ‰SUMÃ‰ DES VÃ‰RIFICATIONS DE SÃ‰CURITÃ‰        â•‘');",
							"console.log('â•‘                                                    â•‘');",
							"console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');",
							"console.log('');",
							"console.log('ğŸ” VÃ‰RIFICATIONS EFFECTUÃ‰ES AVANT ENVOI SMS :');",
							"console.log('');",
							"console.log('   1ï¸âƒ£  Format tÃ©lÃ©phone valide (+223XXXXXXXX)');",
							"console.log('       â”œâ”€ âœ… Validation cÃ´tÃ© DTO (regex)');",
							"console.log('       â””â”€ âŒ Rejet si format invalide');",
							"console.log('');",
							"console.log('   2ï¸âƒ£  NumÃ©ro existe dans la base de donnÃ©es');",
							"console.log('       â”œâ”€ âœ… Recherche en BDD');",
							"console.log('       â””â”€ âŒ Erreur si numÃ©ro non trouvÃ©');",
							"console.log('');",
							"console.log('   3ï¸âƒ£  Compte utilisateur actif');",
							"console.log('       â”œâ”€ âœ… VÃ©rification estActif = true');",
							"console.log('       â””â”€ âŒ Erreur si compte dÃ©sactivÃ©');",
							"console.log('');",
							"console.log('   4ï¸âƒ£  GÃ©nÃ©ration et sauvegarde du code');",
							"console.log('       â”œâ”€ âœ… Code Ã  6 chiffres alÃ©atoires');",
							"console.log('       â”œâ”€ âœ… Expiration : +5 minutes');",
							"console.log('       â””â”€ âœ… Sauvegarde en BDD');",
							"console.log('');",
							"console.log('   5ï¸âƒ£  Envoi du SMS via Twilio');",
							"console.log('       â”œâ”€ âœ… Seulement si toutes les vÃ©rifications OK');",
							"console.log('       â”œâ”€ âœ… Gestion des erreurs Twilio');",
							"console.log('       â””â”€ âœ… Logs dÃ©taillÃ©s');",
							"console.log('');",
							"console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');",
							"console.log('');",
							"console.log('ğŸ“Š RÃ‰SULTATS DES SCÃ‰NARIOS :');",
							"console.log('');",
							"console.log('   âŒ NumÃ©ro non enregistrÃ©    â†’ Pas de SMS âœ…');",
							"console.log('   âœ… NumÃ©ro enregistrÃ©        â†’ SMS envoyÃ© âœ…');",
							"console.log('   âŒ Format invalide          â†’ RejetÃ© âœ…');",
							"console.log('');",
							"console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');",
							"console.log('');",
							"console.log('ğŸ’° Ã‰CONOMIE DE CRÃ‰DITS SMS :');",
							"console.log('');",
							"console.log('   Les SMS ne sont envoyÃ©s QUE pour les numÃ©ros :');",
							"console.log('   âœ“ EnregistrÃ©s dans la base');",
							"console.log('   âœ“ Avec compte actif');",
							"console.log('   âœ“ Format valide');",
							"console.log('');",
							"console.log('   â†’ Protection contre le gaspillage de crÃ©dits !');",
							"console.log('');",
							"console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');",
							"console.log('');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/procedures",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"procedures"
					]
				},
				"description": "Affiche un rÃ©sumÃ© visuel dans la console Postman"
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		}
	]
}

